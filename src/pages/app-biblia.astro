---
import PageLayout from '../layouts/PageLayout.astro';
---

<PageLayout title="Biblia 365 - Mi Amigo Anhelado">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">

  <style is:inline>
    :root {
      --primary: #1a4d2e;
      --accent: #d4a574;
      --bg: #faf8f5;
      --text: #1a202c;
      --surface: #ffffff;
      --border: rgba(0,0,0,0.1);
    }
    body.dark-mode {
      --bg: #0a0e0d;
      --text: #f7fafc;
      --surface: #1a1f1e;
      --primary: #52b788;
    }

    /* ESTO ES LO QUE CENTRA TODO */
    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: 'Crimson Text', serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center; /* Centra horizontalmente */
      min-height: 100vh;
    }

    .wrapper {
      width: 100%;
      max-width: 750px; /* Ancho mÃ¡ximo para que no se vea gigante */
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }

    .app-header { text-align: center; padding: 20px 0; }
    
    .toolbar { 
      position: sticky; 
      top: 10px; 
      background: var(--surface); 
      padding: 12px; 
      border-radius: 15px; 
      display: flex; 
      justify-content: space-between; 
      z-index: 100; 
      border: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 25px;
    }

    button { 
      padding: 10px 18px; 
      border: none; 
      border-radius: 8px; 
      background: var(--primary); 
      color: white; 
      cursor: pointer; 
      font-weight: bold; 
      font-family: inherit;
    }

    /* EFECTO ACORDEÃ“N / TARJETAS */
    .card-lectura { 
      background: var(--surface); 
      border-radius: 20px; 
      padding: 30px; 
      margin-bottom: 30px; 
      border: 1px solid var(--border);
      box-shadow: 0 4px 6px rgba(0,0,0,0.02);
      width: 100%; /* Ocupa todo el ancho del wrapper */
      box-sizing: border-box;
    }

    .titulo-libro {
      font-family: 'Playfair Display', serif;
      font-size: 2.2rem;
      color: var(--primary);
      margin-bottom: 20px;
      text-align: center;
      border-bottom: 2px solid var(--accent);
      padding-bottom: 10px;
    }

    .versiculo { 
      font-size: var(--f-size, 20px); 
      line-height: 1.8; 
      margin-bottom: 15px; 
      display: block; 
    }
    .v-num { color: var(--accent); font-weight: bold; margin-right: 8px; }

    .nav-footer { 
      display: flex; 
      gap: 15px; 
      margin-top: 20px; 
      padding-bottom: 100px; 
    }
    .btn-nav { flex: 1; padding: 18px; font-size: 1.1rem; }
  </style>

  <div class="wrapper">
    <div class="app-header">
      <h1 style="font-family: 'Playfair Display'; font-size: 2.5rem; color: var(--primary);">BIBLIA 365</h1>
      <p>DÃ­a <span id="numDia">...</span></p>
    </div>

    <div class="toolbar">
      <button onclick="window.zoom(-2)">A-</button>
      <button onclick="window.zoom(2)">A+</button>
      <button onclick="window.modoNoche()">ðŸŒ“</button>
    </div>

    <div id="lector">
      </div>

    <div class="nav-footer">
      <button class="btn-nav" onclick="window.cambiarDia(-1)">â—€ Anterior</button>
      <button class="btn-nav" onclick="window.irHoy()">Hoy</button>
      <button class="btn-nav" onclick="window.cambiarDia(1)">Siguiente â–¶</button>
    </div>
  </div>

  <script is:inline>
    // Usando los IDs exactos de tu biblia.json
    const LIBROS = [
      {n:'GÃ©nesis', id:'genesis', c:50}, {n:'Ã‰xodo', id:'exodo', c:40}, {n:'LevÃ­tico', id:'levitico', c:27},
      {n:'NÃºmeros', id:'numeros', c:36}, {n:'Deuteronomio', id:'deuteronomio', c:34}, {n:'JosuÃ©', id:'josue', c:24},
      {n:'Jueces', id:'jueces', c:21}, {n:'Rut', id:'rut', c:4}, {n:'1 Samuel', id:'1-samuel', c:31},
      {n:'2 Samuel', id:'2-samuel', c:24}, {n:'1 Reyes', id:'1-reyes', c:22}, {n:'2 Reyes', id:'2-reyes', c:25},
      {n:'1 CrÃ³nicas', id:'1-cronicas', c:29}, {n:'2 CrÃ³nicas', id:'2-cronicas', c:36}, {n:'Esdras', id:'esdras', c:10},
      {n:'NehemÃ­as', id:'nehemias', c:13}, {n:'Ester', id:'ester', c:10}, {n:'Job', id:'job', c:42},
      {n:'Salmos', id:'salmos', c:150}, {n:'Proverbios', id:'proverbios', c:31}, {n:'EclesiastÃ©s', id:'eclesiastes', c:12},
      {n:'Cantares', id:'cantares', c:8}, {n:'IsaÃ­as', id:'isaias', c:66}, {n:'JeremÃ­as', id:'jeremias', c:52},
      {n:'Lamentaciones', id:'lamentaciones', c:5}, {n:'Ezequiel', id:'ezequiel', c:48}, {n:'Daniel', id:'daniel', c:12},
      {n:'Oseas', id:'oseas', c:14}, {n:'Joel', id:'joel', c:3}, {n:'AmÃ³s', id:'amos', c:9},
      {n:'AbdÃ­as', id:'abdias', c:1}, {n:'JonÃ¡s', id:'jonas', c:4}, {n:'Miqueas', id:'miqueas', c:7},
      {n:'NahÃºm', id:'nahum', c:3}, {n:'Habacuc', id:'habacuc', c:3}, {n:'SofonÃ­as', id:'sofonias', c:3},
      {n:'Hageo', id:'hageo', c:2}, {n:'ZacarÃ­as', id:'zacarias', c:14}, {n:'MalaquÃ­as', id:'malaquias', c:4},
      {n:'Mateo', id:'mateo', c:28}, {n:'Marcos', id:'marcos', c:16}, {n:'Lucas', id:'lucas', c:24},
      {n:'Juan', id:'juan', c:21}, {n:'Hechos', id:'hechos', c:28}, {n:'Romanos', id:'romanos', c:16},
      {n:'1 Corintios', id:'1-corintios', c:16}, {n:'2 Corintios', id:'2-corintios', c:13}, {n:'GÃ¡latas', id:'galatas', c:6},
      {n:'Efesios', id:'efesios', c:6}, {n:'Filipenses', id:'filipenses', c:4}, {n:'Colosenses', id:'colosenses', c:4},
      {n:'1 Tesalonicenses', id:'1-tesalonicenses', c:5}, {n:'2 Tesalonicenses', id:'2-tesalonicenses', c:3},
      {n:'1 Timoteo', id:'1-timoteo', c:6}, {n:'2 Timoteo', id:'2-timoteo', c:4}, {n:'Tito', id:'tito', c:3},
      {n:'FilemÃ³n', id:'filemon', c:1}, {n:'Hebreos', id:'hebreos', c:13}, {n:'Santiago', id:'santiago', c:5},
      {n:'1 Pedro', id:'1-pedro', c:5}, {n:'2 Pedro', id:'2-pedro', c:3}, {n:'1 Juan', id:'1-juan', c:5},
      {n:'2 Juan', id:'2-juan', c:1}, {n:'3 Juan', id:'3-juan', c:1}, {n:'Judas', id:'judas', c:1},
      {n:'Apocalipsis', id:'apocalipsis', c:22}
    ];

    let bibliaJSON = null;
    let fecha = new Date();
    let fontSize = 20;
    let planFull = [];
    LIBROS.forEach(l => { for(let i=1; i<=l.c; i++) planFull.push({n:l.n, id:l.id, c:i}); });

    async function cargar() {
      try {
        const res = await fetch('/biblia.json');
        bibliaJSON = await res.json();
        mostrar();
      } catch (e) {
        document.getElementById('lector').innerHTML = "<p>Error: No se pudo cargar la Biblia.</p>";
      }
    }

    function mostrar() {
      const start = new Date(fecha.getFullYear(), 0, 0);
      const diaAnio = Math.floor((fecha - start) / 86400000);
      document.getElementById('numDia').innerText = diaAnio;

      const idx = (diaAnio - 1) * 3;
      const hoy = planFull.slice(idx, idx + 3);
      
      let html = "";
      hoy.forEach(item => {
        const libro = bibliaJSON[item.id];
        const cap = libro ? libro[item.c] : null;
        if (cap) {
          html += `<div class="card-lectura"><h2 class="titulo-libro">${item.n} ${item.cap || item.c}</h2>`;
          Object.entries(cap).forEach(([num, texto]) => {
            const limpio = texto.replace(/^\d+\/n/, '').replace(/\/n/g, '<br>');
            html += `<span class="versiculo"><span class="v-num">${num}</span>${limpio}</span>`;
          });
          html += `</div>`;
        }
      });
      document.getElementById('lector').innerHTML = html;
      window.scrollTo(0,0);
    }

    window.zoom = (n) => { fontSize += n; document.documentElement.style.setProperty('--f-size', fontSize + 'px'); };
    window.modoNoche = () => document.body.classList.toggle('dark-mode');
    window.cambiarDia = (n) => { fecha.setDate(fecha.getDate() + n); mostrar(); };
    window.irHoy = () => { fecha = new Date(); mostrar(); };

    document.addEventListener('DOMContentLoaded', cargar);
  </script>
</PageLayout>

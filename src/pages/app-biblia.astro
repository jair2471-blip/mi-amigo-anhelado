---
import PageLayout from '../layouts/PageLayout.astro';
---

<PageLayout title="Biblia 365">
  <style is:inline>
    :root { --primary: #1a4d2e; --accent: #d4a574; --bg: #faf8f5; --text: #1a202c; --surface: #ffffff; }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 20px; }
    .container { max-width: 650px; margin: 0 auto; }
    .card { background: var(--surface); padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .titulo { color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 5px; }
    .v-num { color: var(--accent); font-weight: bold; margin-right: 8px; font-size: 0.9em; }
    .btn-nav { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    .header-dia { text-align: center; font-size: 2rem; font-weight: bold; color: var(--primary); margin-bottom: 10px; }
  </style>

  <div class="container">
    <div class="header-dia">Día <span id="numDia">1</span></div>
    
    <div style="display:flex; justify-content: space-between; margin-bottom: 20px;">
      <button class="btn-nav" onclick="window.cambiarDia(-1)">◀ Anterior</button>
      <button class="btn-nav" onclick="window.irHoy()">Hoy</button>
      <button class="btn-nav" onclick="window.cambiarDia(1)">Siguiente ▶</button>
    </div>

    <div id="contenido">Cargando Palabra Sagrada...</div>
  </div>

  <script is:inline>
    // 1. ESTA LISTA TIENE LOS NOMBRES EXACTOS DE TU JSON
    const PLAN = [
      {n:'Génesis', id:'genesis', c:50}, {n:'Éxodo', id:'exodo', c:40}, {n:'Levítico', id:'levitico', c:27},
      {n:'Números', id:'numeros', c:36}, {n:'Deuteronomio', id:'deuteronomio', c:34}, {n:'Josué', id:'josue', c:24},
      {n:'Jueces', id:'jueces', c:21}, {n:'Rut', id:'rut', c:4}, {n:'1 Samuel', id:'1-samuel', c:31},
      {n:'2 Samuel', id:'2-samuel', c:24}, {n:'1 Reyes', id:'1-reyes', c:22}, {n:'2 Reyes', id:'2-reyes', c:25},
      {n:'1 Crónicas', id:'1-cronicas', c:29}, {n:'2 Crónicas', id:'2-cronicas', c:36}, {n:'Esdras', id:'esdras', c:10},
      {n:'Nehemías', id:'nehemias', c:13}, {n:'Ester', id:'ester', c:10}, {n:'Job', id:'job', c:42},
      {n:'Salmos', id:'salmos', c:150}, {n:'Proverbios', id:'proverbios', c:31}, {n:'Eclesiastés', id:'eclesiastes', c:12},
      {n:'Cantares', id:'cantares', c:8}, {n:'Isaías', id:'isaias', c:66}, {n:'Jeremías', id:'jeremias', c:52},
      {n:'Lamentaciones', id:'lamentaciones', c:5}, {n:'Ezequiel', id:'ezequiel', c:48}, {n:'Daniel', id:'daniel', c:12},
      {n:'Oseas', id:'oseas', c:14}, {n:'Joel', id:'joel', c:3}, {n:'Amós', id:'amos', c:9},
      {n:'Abdías', id:'abdias', c:1}, {n:'Jonás', id:'jonas', c:4}, {n:'Miqueas', id:'miqueas', c:7},
      {n:'Nahúm', id:'nahum', c:3}, {n:'Habacuc', id:'habacuc', c:3}, {n:'Sofonías', id:'sofonias', c:3},
      {n:'Hageo', id:'hageo', c:2}, {n:'Zacarías', id:'zacarias', c:14}, {n:'Malaquías', id:'malaquias', c:4},
      {n:'Mateo', id:'mateo', c:28}, {n:'Marcos', id:'marcos', c:16}, {n:'Lucas', id:'lucas', c:24},
      {n:'Juan', id:'juan', c:21}, {n:'Hechos', id:'hechos', c:28}, {n:'Romanos', id:'romanos', c:16},
      {n:'1 Corintios', id:'1-corintios', c:16}, {n:'2 Corintios', id:'2-corintios', c:13}, {n:'Gálatas', id:'galatas', c:6},
      {n:'Efesios', id:'efesios', c:6}, {n:'Filipenses', id:'filipenses', c:4}, {n:'Colosenses', id:'colosenses', c:4},
      {n:'1 Tesalonicenses', id:'1-tesalonicenses', c:5}, {n:'2 Tesalonicenses', id:'2-tesalonicenses', c:3},
      {n:'1 Timoteo', id:'1-timoteo', c:6}, {n:'2 Timoteo', id:'2-timoteo', c:4}, {n:'Tito', id:'tito', c:3},
      {n:'Filemón', id:'filemon', c:1}, {n:'Hebreos', id:'hebreos', c:13}, {n:'Santiago', id:'santiago', c:5},
      {n:'1 Pedro', id:'1-pedro', c:5}, {n:'2 Pedro', id:'2-pedro', c:3}, {n:'1 Juan', id:'1-juan', c:5},
      {n:'2 Juan', id:'2-juan', c:1}, {n:'3 Juan', id:'3-juan', c:1}, {n:'Judas', id:'judas', c:1},
      {n:'Apocalipsis', id:'apocalipsis', c:22}
    ];

    let biblia = null;
    let fecha = new Date();
    let listaCapitulos = [];
    PLAN.forEach(b => { for(let i=1; i<=b.c; i++) listaCapitulos.push({ nombre: b.n, id: b.id, cap: i }); });

    async function cargar() {
      const res = await fetch('/biblia.json');
      biblia = await res.json();
      mostrar();
    }

    function mostrar() {
      const dia = Math.floor((fecha - new Date(fecha.getFullYear(), 0, 0)) / 86400000);
      document.getElementById('numDia').innerText = dia;
      
      const idx = (dia - 1) * 3;
      const hoy = listaCapitulos.slice(idx, idx + 3);
      
      let html = "";
      hoy.forEach(item => {
        const dataLibro = biblia[item.id];
        const dataCap = dataLibro ? dataLibro[item.cap] : null;

        if (dataCap) {
          html += `<div class="card"><h2 class="titulo">${item.nombre} ${item.cap}</h2>`;
          Object.entries(dataCap).forEach(([num, texto]) => {
            const limpio = texto.replace(/^\d+\/n/, '').replace(/\/n/g, '<br>');
            html += `<p><span class="v-num">${num}</span>${limpio}</p>`;
          });
          html += `</div>`;
        }
      });
      document.getElementById('contenido').innerHTML = html || "No hay lecturas para este día.";
      window.scrollTo(0,0);
    }

    window.cambiarDia = (n) => { fecha.setDate(fecha.getDate() + n); mostrar(); };
    window.irHoy = () => { fecha = new Date(); mostrar(); };

    document.addEventListener('DOMContentLoaded', cargar);
  </script>
</PageLayout>
